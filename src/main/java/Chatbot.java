import java.io.File;import java.io.FileNotFoundException;import java.io.FileWriter;import java.io.IOException;import java.time.LocalDate;import java.time.format.DateTimeFormatter;import java.time.format.DateTimeParseException;import java.util.ArrayList;import java.util.List;import java.util.Scanner;public class Chatbot {    /** Name of the Chatbot. */    private static final String NAME = "Bro";    /** Scanner for the Chatbot. */    private Scanner scanner;    /** TaskList for the Chatbot. */    private List<Task> taskList;    /**     * Constructor for the Chatbot.     * Loads existing tasks from the hard disk and creates the data file and directory if it does not exist.     */    private Chatbot() {        this.scanner = new Scanner(System.in);        this.taskList = new ArrayList<>();    }    /**     * Greets the user.     */    private void greet() {        System.out.println("Hello! I'm " + NAME + "\n" + "What can I do for you?\n");    }    /**     * Causes Chatbot to exit.     */    private void exit() {        System.out.println("Bye. Hope to see you again soon!");        this.saveTasks();        this.scanner.close();    }    /**     * Adds task inputted by user to taskList. Prints out confirmation.     *     * @param input The command inputted by the user.     * @throws InvalidTodoException If format of Todo entered is invalid.     * @throws InvalidDeadlineException If format of Deadline entered is invalid.     * @throws InvalidEventException If format of Event entered is invalid.     * @throws InvalidCommandException If format of command entered is invalid.     */    private void add(String input) throws InvalidTodoException,            InvalidDeadlineException, InvalidEventException, InvalidCommandException {        Task newTask = null;        String nextInput;        try {            nextInput = input.substring(4);            if (nextInput.isBlank()) {                throw new InvalidCommandException();            }        } catch (StringIndexOutOfBoundsException e) {            throw new InvalidCommandException();        }        if (nextInput.startsWith("todo")) {            try {                String description = nextInput.substring(5);                if (description.isBlank()) {                    throw new InvalidTodoException();                } else {                    newTask = new Todo(description);                }            } catch (StringIndexOutOfBoundsException e) {                throw new InvalidTodoException();            }        } else if (nextInput.startsWith("deadline")) {            try {                int by = nextInput.indexOf("/by");                String description = nextInput.substring(9, by - 1);                LocalDate deadline = LocalDate.parse(nextInput.substring(by + 4));                if (description.isBlank()) {                    throw new InvalidDeadlineException();                } else {                    newTask = new Deadline(description, deadline);                }            } catch (StringIndexOutOfBoundsException e) {                throw new InvalidDeadlineException();            } catch (DateTimeParseException e) {            throw new InvalidDeadlineException();            }        } else if (nextInput.startsWith("event")) {            try {                int from = nextInput.indexOf("/from");                int to = nextInput.indexOf("/to");                String description = nextInput.substring(6, from - 1);                LocalDate start = LocalDate.parse(nextInput.substring(from + 6, to - 1));                LocalDate end = LocalDate.parse(nextInput.substring(to + 4));                if (description.isBlank()) {                    throw new InvalidEventException();                } else {                    newTask = new Event(description, start, end);                }            } catch (StringIndexOutOfBoundsException e) {                throw new InvalidEventException();            } catch (DateTimeParseException e) {                throw new InvalidEventException();            }        } else {            throw new InvalidCommandException();        }        if (newTask != null) {            this.taskList.add(newTask);            System.out.println("Got it. I've added this task:\n" + newTask);            System.out.println("Now you have " + this.taskList.size() + " tasks in the list.\n");        }    }    /**     * Lists out all the tasks in taskList.     */    private void listTasks() {        System.out.println("Here are the tasks in your list:\n");        for (int i = 0; i < taskList.size(); i++) {            int num = i + 1;            System.out.println(num +". " + taskList.get(i).toString());        }        System.out.print("\n");    }    /**     * Marks specified task as done. Prints confirmation.     *     * @param input The user input.     * @throws InvalidTaskNumberException If there is no task with the task number in the taskList.     * @throws InvalidCommandException If format of command entered is invalid.     */    private void markTaskStatusTrue(String input) throws InvalidTaskNumberException, InvalidCommandException {        int taskIndex;        try {            String nextInput = input.substring(5);            if (nextInput.isBlank()) {                throw new InvalidCommandException();            } else {                taskIndex = Integer.parseInt(nextInput);            }        } catch (StringIndexOutOfBoundsException e) {            throw new InvalidCommandException();        }        if (taskIndex > this.taskList.size()) {            throw new InvalidTaskNumberException(taskIndex);        } else {            Task task = taskList.get(taskIndex - 1);            task.markStatus(true);            System.out.println("Nice! I've marked this task as done:\n" + task + "\n");        }    }    /**     * Marks specified task as undone. Prints confirmation.     *     * @param input The user input.     * @throws InvalidTaskNumberException If there is no task with the task number in the taskList.     * @throws InvalidCommandException If format of command entered is invalid.     */    private void markTaskStatusFalse(String input) throws InvalidTaskNumberException, InvalidCommandException {        int taskIndex;        try {            String nextInput = input.substring(7);            if (nextInput.isBlank()) {                throw new InvalidCommandException();            } else {                taskIndex = Integer.parseInt(nextInput);            }        } catch (StringIndexOutOfBoundsException e) {            throw new InvalidCommandException();        }        if (taskIndex > this.taskList.size()) {            throw new InvalidTaskNumberException(taskIndex);        } else {            Task task = taskList.get(taskIndex - 1);            task.markStatus(false);            System.out.println("OK, I've marked this task as not done yet:\n" + task + "\n");        }    }    /**     * Deletes the specified task in the list.     *     * @param input The user input.     * @throws InvalidTaskNumberException If there is no task with the task number in the taskList.     * @throws InvalidCommandException If format of command entered is invalid.     */    public void delete(String input) throws InvalidTaskNumberException, InvalidCommandException {        int taskIndex;        try {            String nextInput = input.substring(7);            if (nextInput.isBlank()) {                throw new InvalidCommandException();            } else {                taskIndex = Integer.parseInt(nextInput);            }        } catch (StringIndexOutOfBoundsException e) {            throw new InvalidCommandException();        }        Task removed;        try {            removed = this.taskList.remove(taskIndex - 1);        } catch (IndexOutOfBoundsException e) {            throw new InvalidTaskNumberException(taskIndex);        }        System.out.println("Noted. I've removed this task:\n" + removed + "\n");    }    /**     * Loads file input and adds respective tasks into chatbot taskList.     */    private void loadTasksFromFile() {        File directory = new File("data");        if (!directory.exists()) {            directory.mkdir();        }        File data = new File("data/tasks.txt");        try {            if (data.exists()) {                Scanner dataScanner = new Scanner(data);                while (dataScanner.hasNextLine()) {                    String task = dataScanner.nextLine();                    if (task.startsWith("[T]")) {                        String description = task.substring(7);                        if (description.isBlank()) {                            throw new InvalidFileFormatException();                        } else {                            this.taskList.add(new Todo(description));                        }                    } else if (task.startsWith("[D]")) {                        int by = task.indexOf("(by: ");                        String description = task.substring(7, by - 1);                        LocalDate deadline = LocalDate.parse(task.substring(by + 5, task.length() - 1),                                DateTimeFormatter.ofPattern("MMM d yyyy"));                        if (description.isBlank()) {                            throw new InvalidFileFormatException();                        } else {                            this.taskList.add(new Deadline(description, deadline));                        }                    } else if (task.startsWith("[E]")) {                        int from = task.indexOf("(from: ");                        int to = task.indexOf("to: ");                        String description = task.substring(7, from - 1);                        LocalDate start = LocalDate.parse(task.substring(from + 7, to - 1),                                DateTimeFormatter.ofPattern("MMM d yyyy"));                        LocalDate end = LocalDate.parse(task.substring(to + 4, task.length() - 1),                                DateTimeFormatter.ofPattern("MMM d yyyy"));                        if (description.isBlank()) {                            throw new InvalidFileFormatException();                        } else {                            this.taskList.add(new Event(description, start, end));                        }                    } else {                        throw new InvalidFileFormatException();                    }                }                dataScanner.close();            } else {                data.createNewFile();            }        } catch (Exception e) {            System.out.println(e.getMessage());        }    }    /**     * Reads user input. Exits if user input is "bye", lists tasks if input is "list", else, echoes commands.     * Update current state of tasks to data file.     */    private void readInput() {        System.out.print("> ");        String userInput = scanner.nextLine();        try {            if (userInput.equals("list")) {                this.listTasks();            } else if (userInput.equals("bye")) {                this.exit();            } else if (userInput.startsWith("add ")) {                this.add(userInput);            } else if (userInput.startsWith("mark ")) {                this.markTaskStatusTrue(userInput);            } else if (userInput.startsWith("unmark ")) {                this.markTaskStatusFalse(userInput);            } else if (userInput.startsWith("delete ")) {                this.delete(userInput);            } else {                throw new InvalidCommandException();            }            this.saveTasks();        } catch (Exception e) {            System.out.println(e.getMessage() + "\n");        } finally {            if (!userInput.equals("bye")) {                this.readInput();            }        }    }    /**     * Saves current taskList to data file.     */    public void saveTasks() {        try {            FileWriter fw = new FileWriter("data/tasks.txt");            for (int i = 0; i < this.taskList.size(); i++) {                fw.write(this.taskList.get(i).toString() + "\n");            }            fw.close();        } catch (Exception e) {            System.out.println(e.getMessage());        }    }    public static void main(String[] args) {        Chatbot chatbot = new Chatbot();        chatbot.loadTasksFromFile();        chatbot.greet();        chatbot.readInput();    }}